# This workflow will build a .NET project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-net

run-name: Upload of ${{ github.ref_name }} by @${{ github.actor }}
on:
  create
jobs:
  build:
    runs-on: ubuntu-latest
    env:
      GH_TOKEN: ${{ github.token }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 7.0.x
      - name: Restoring Projects
        run: |
          dotnet restore ./src/Chirp.CLI
          dotnet restore ./test/Chirp.CLI.Test
          dotnet restore ./src/SimpleDB
          dotnet restore ./test/SimpleDB.Test
      - name: Building Projects
        run: |
          dotnet build ./src/Chirp.CLI
          dotnet build ./test/Chirp.CLI.Test
          dotnet build ./src/SimpleDB
          dotnet build ./test/SimpleDB.Test
      - name: Testing Projects
        run: |
          dotnet test --no-build --verbosity normal "./test/Chirp.CLI.Test"
          dotnet test --no-build --verbosity normal "./test/SimpleDB.Test"
      - name: Publish
        run: |
          dotnet publish ./src/Chirp.CLI -c Release -r linux-x64
          dotnet publish ./src/Chirp.CLI -c Release -r win-x64
          dotnet publish ./src/Chirp.CLI -c Release -r osx-x64
          dotnet publish ./src/SimpleDB -c Release -r linux-x64
          dotnet publish ./src/SimpleDB -c Release -r win-x64
          dotnet publish ./src/SimpleDB -c Release -r osx-x64
      #- name: Release
      #  run: |
      #    cd ./src/Chirp.CLI/bin/Release/net7.0/release
       #   gh release create ${{ github.ref_name }} -t "Release v${{ github.ref_name }}" ./Chirp.CLI.exe ./Chirp.CLI.dll ./Chirp.CLI.pdb
       #   cd ../../../../../SimpleDB/bin/Release/net7.0/release